{# WordPress theme.js template - Jinja2 #}
{# Main theme JavaScript #}
{# Variables: theme, features #}
/**
 * {{ theme.theme_display_name }} - Theme JavaScript
 *
 * @package {{ theme.theme_display_name | replace(' ', '_') }}
 */

(function() {
    'use strict';

    // Wait for DOM to be ready
    document.addEventListener('DOMContentLoaded', function() {
        initMobileNavigation();
        {% if navigation.show_search %}
        initSearchToggle();
        {% endif %}
        {% if features.back_to_top %}
        initBackToTop();
        {% endif %}
        {% if features.smooth_scroll %}
        initSmoothScroll();
        {% endif %}
        {% if features.dark_mode %}
        initDarkModeToggle();
        {% endif %}
    });

    /**
     * Mobile Navigation Toggle
     */
    function initMobileNavigation() {
        var menuToggle = document.querySelector('.mobile-menu-toggle');
        var navigation = document.querySelector('.main-navigation');

        if (!menuToggle || !navigation) {
            return;
        }

        menuToggle.addEventListener('click', function() {
            var expanded = this.getAttribute('aria-expanded') === 'true';
            this.setAttribute('aria-expanded', !expanded);
            navigation.classList.toggle('is-active');
            document.body.classList.toggle('mobile-menu-open');
        });

        // Close menu when clicking outside
        document.addEventListener('click', function(e) {
            if (!navigation.contains(e.target) && !menuToggle.contains(e.target)) {
                menuToggle.setAttribute('aria-expanded', 'false');
                navigation.classList.remove('is-active');
                document.body.classList.remove('mobile-menu-open');
            }
        });

        // Close menu on escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                menuToggle.setAttribute('aria-expanded', 'false');
                navigation.classList.remove('is-active');
                document.body.classList.remove('mobile-menu-open');
            }
        });
    }

    {% if navigation.show_search %}
    /**
     * Search Toggle
     */
    function initSearchToggle() {
        var searchToggle = document.querySelector('.search-toggle');
        var searchWrapper = document.querySelector('.search-form-wrapper');

        if (!searchToggle || !searchWrapper) {
            return;
        }

        searchToggle.addEventListener('click', function() {
            var isHidden = searchWrapper.getAttribute('aria-hidden') === 'true';
            searchWrapper.setAttribute('aria-hidden', !isHidden);
            searchWrapper.classList.toggle('is-active');

            if (isHidden) {
                searchWrapper.querySelector('input[type="search"]').focus();
            }
        });
    }
    {% endif %}

    {% if features.back_to_top %}
    /**
     * Back to Top Button
     */
    function initBackToTop() {
        var backToTop = document.getElementById('back-to-top');

        if (!backToTop) {
            return;
        }

        // Show/hide button based on scroll position
        window.addEventListener('scroll', function() {
            if (window.scrollY > 300) {
                backToTop.classList.add('is-visible');
            } else {
                backToTop.classList.remove('is-visible');
            }
        });

        // Scroll to top on click
        backToTop.addEventListener('click', function() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
    }
    {% endif %}

    {% if features.smooth_scroll %}
    /**
     * Smooth Scroll for Anchor Links
     */
    function initSmoothScroll() {
        document.querySelectorAll('a[href^="#"]').forEach(function(anchor) {
            anchor.addEventListener('click', function(e) {
                var targetId = this.getAttribute('href');

                if (targetId === '#') {
                    return;
                }

                var target = document.querySelector(targetId);

                if (target) {
                    e.preventDefault();
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });

                    // Update URL hash
                    history.pushState(null, null, targetId);
                }
            });
        });
    }
    {% endif %}

    {% if features.dark_mode %}
    /**
     * Dark Mode Toggle
     */
    function initDarkModeToggle() {
        var darkModeToggle = document.querySelector('.dark-mode-toggle');

        if (!darkModeToggle) {
            return;
        }

        darkModeToggle.addEventListener('click', function() {
            var isDark = document.documentElement.classList.toggle('dark-mode');
            localStorage.setItem('{{ theme.theme_name }}-dark-mode', isDark);

            // Update toggle button aria-label
            this.setAttribute(
                'aria-label',
                isDark ? 'Switch to light mode' : 'Switch to dark mode'
            );
        });
    }
    {% endif %}

})();
